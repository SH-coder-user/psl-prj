<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Anon Board Test</title>
</head>
<body>
  <h1>Anon Board API 테스트</h1>

  <h2>회원가입</h2>
  <input id="signup-username" placeholder="Username" />
  <input id="signup-password" type="password" placeholder="Password" />
  <button onclick="signup()">회원가입</button>
  <p id="signup-result"></p>

  <h2>로그인</h2>
  <input id="login-username" placeholder="Username" />
  <input id="login-password" type="password" placeholder="Password" />
  <button onclick="login()">로그인</button>
  <p id="login-result"></p>

  <h2>게시글 조회</h2>
  <button onclick="fetchPosts()">게시글 불러오기</button>
  <ul id="posts-list"></ul>

  <h2>게시글 생성 (인증 필요)</h2>
  <input id="post-title" placeholder="제목" />
  <textarea id="post-content" placeholder="내용"></textarea>
  <button onclick="createPost()">게시글 생성</button>
  <p id="post-result"></p>

<script>
  async function signup() {
    const username = document.getElementById('signup-username').value;
    const password = document.getElementById('signup-password').value;
    const res = await fetch('/api/auth/signup', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ username, password }),
    });
    const data = await res.json();
    document.getElementById('signup-result').textContent = data.message || JSON.stringify(data);
  }

  async function login() {
    const username = document.getElementById('login-username').value;
    const password = document.getElementById('login-password').value;
    const res = await fetch('/api/auth/login', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      credentials: 'include', // 쿠키 포함
      body: JSON.stringify({ username, password }),
    });
    const data = await res.json();
    document.getElementById('login-result').textContent = data.message || JSON.stringify(data);
  }

  async function fetchPosts() {
    const res = await fetch('/api/posts');
    const posts = await res.json();
    const list = document.getElementById('posts-list');
    list.innerHTML = '';
    posts.forEach(post => {
      const li = document.createElement('li');
      li.textContent = `${post.title} - ${post.author || '익명'} (${new Date(post.createdAt).toLocaleString()})`;
      list.appendChild(li);
    });
  }

  async function createPost() {
    const title = document.getElementById('post-title').value;
    const content = document.getElementById('post-content').value;
    const res = await fetch('/api/posts', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      credentials: 'include', // 쿠키 포함해서 인증 토큰 보내기
      body: JSON.stringify({ title, content }),
    });
    const data = await res.json();
    document.getElementById('post-result').textContent = data.message || '게시글 생성 완료!';
    fetchPosts();
  }
</script>

</body>
</html>
